{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags %}

{% block header_content %}
<div class="mb-8">
    {% with parent=page.get_parent %}
    <a href="{% pageurl parent %}" class="group inline-flex items-center gap-2.5 rounded-xl bg-white/10 px-4 py-2 text-sm font-medium text-indigo-100 ring-1 ring-white/15 backdrop-blur-md transition-all duration-200 hover:bg-white/20 hover:ring-white/30">
        <svg class="h-4 w-4 transition-transform duration-200 group-hover:-translate-x-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Tous les événements
    </a>
    {% endwith %}
</div>
<div class="flex flex-wrap items-center justify-between gap-6">
    <div class="flex items-center gap-5">
        <h1 class="bg-gradient-to-r from-white via-indigo-100 to-white bg-clip-text text-3xl font-extrabold tracking-tight text-transparent sm:text-4xl">{{ page.title }}</h1>
    </div>
    {% if can_edit %}
    <a href="{{ wagtail_edit_url }}" target="_blank"
       class="inline-flex items-center gap-2 rounded-xl bg-white/10 px-5 py-2.5 text-sm font-semibold text-white ring-1 ring-white/20 backdrop-blur-md transition-all duration-200 hover:bg-white/20 hover:ring-white/30 hover:shadow-lg">
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
        </svg>
        Modifier
    </a>
    {% endif %}
</div>
<div class="mt-6 flex flex-wrap items-center gap-3 text-indigo-100">
    <span class="inline-flex items-center gap-2.5 rounded-xl bg-white/10 px-4 py-2 text-sm font-medium ring-1 ring-white/10 backdrop-blur-sm">
        <svg class="h-4 w-4 text-indigo-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        {{ page.date_event|date:"l d F Y" }}
    </span>
    <span class="inline-flex items-center gap-2.5 rounded-xl bg-white/10 px-4 py-2 text-sm font-medium ring-1 ring-white/10 backdrop-blur-sm">
        <svg class="h-4 w-4 text-indigo-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        {{ page.date_event|date:"H:i" }}
    </span>
</div>
{% endblock %}

{% block content %}
<main class="mx-auto max-w-5xl px-4 py-14 sm:px-6 lg:px-8">
    <div class="grid gap-8 lg:grid-cols-3">

        <!-- Main content -->
        <div class="lg:col-span-2 space-y-8">
            {% if page.notes %}
            <section class="overflow-hidden rounded-2xl bg-white shadow-lg shadow-slate-200/50 ring-1 ring-slate-200/60">
                <div class="h-1.5 bg-gradient-to-r from-blason-600 via-blason-400 to-blason-600"></div>
                <div class="p-6 sm:p-8">
                    <h2 class="flex items-center gap-2.5 text-lg font-bold text-slate-800">
                        <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-blason-50 ring-1 ring-blason-100">
                            <svg class="h-4.5 w-4.5 text-blason-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        Notes & Comptes-rendus
                    </h2>
                    <div class="mt-6 prose prose-slate max-w-none prose-headings:text-blason-700 prose-headings:text-base prose-headings:font-semibold prose-p:leading-relaxed prose-li:leading-relaxed">
                        {% include_block page.notes %}
                    </div>
                </div>
            </section>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <aside class="space-y-6">
            {% if event_images %}
            <div class="overflow-hidden rounded-2xl bg-white shadow-lg shadow-slate-200/50 ring-1 ring-slate-200/60">
                <div class="h-1.5 bg-gradient-to-r from-amber-400 via-orange-500 to-amber-400"></div>
                <div class="p-6">
                    <h2 class="flex items-center gap-2.5 text-base font-bold text-slate-800">
                        <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-amber-50 ring-1 ring-amber-100">
                            <svg class="h-4 w-4 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        Images
                    </h2>
                    <div class="mt-5 grid grid-cols-2 gap-3">
                        {% for event_image in event_images %}
                        <figure class="group">
                            {% image event_image.image original as full_img %}
                            <a href="{{ full_img.url }}" target="_blank" rel="noopener" class="block overflow-hidden rounded-xl shadow-sm ring-1 ring-slate-100 transition-all duration-300 hover:shadow-md hover:ring-blason-200">
                                {% image event_image.image fill-300x200 alt=event_image.caption|default:event_image.image.title class="w-full object-cover transition-transform duration-300 group-hover:scale-105" %}
                            </a>
                            {% if event_image.caption %}
                            <figcaption class="mt-2 text-xs text-slate-500 leading-relaxed">{{ event_image.caption }}</figcaption>
                            {% endif %}
                        </figure>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            {% if documents_by_collection %}
            <div class="overflow-hidden rounded-2xl bg-white shadow-lg shadow-slate-200/50 ring-1 ring-slate-200/60">
                <div class="h-1.5 bg-gradient-to-r from-emerald-400 via-teal-500 to-emerald-400"></div>
                <div class="p-6">
                    <h2 class="flex items-center gap-2.5 text-base font-bold text-slate-800">
                        <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-emerald-50 ring-1 ring-emerald-100">
                            <svg class="h-4 w-4 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                            </svg>
                        </div>
                        Documents rattachés
                    </h2>
                    <div class="mt-6 space-y-6">
                        {% for collection, docs in documents_by_collection.items %}
                        <div>
                            <h3 class="mb-3 flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-slate-400">
                                <span class="inline-block h-2 w-2 rounded-full bg-emerald-400"></span>
                                {{ collection }}
                            </h3>
                            <ul class="space-y-2.5">
                                {% for event_doc in docs %}
                                <li class="rounded-xl bg-slate-50/80 ring-1 ring-slate-100 transition-all duration-200 hover:bg-slate-100 hover:ring-slate-200 hover:shadow-sm">
                                    <a href="{{ event_doc.document.url }}" target="_blank" rel="noopener" class="flex items-start gap-3 px-4 py-3.5 no-underline">
                                        <div class="flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-xl bg-white shadow-sm ring-1 ring-slate-200">
                                            <svg class="h-4 w-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                            </svg>
                                        </div>
                                        <div class="min-w-0">
                                            <span class="block text-sm font-semibold text-slate-700 leading-tight">{{ event_doc.document.title }}</span>
                                            {% if event_doc.notes %}
                                            <span class="block mt-1.5 text-xs text-slate-500 leading-relaxed">{{ event_doc.notes }}</span>
                                            {% endif %}
                                            {% if event_doc.document.document_date %}
                                            <span class="block mt-1 text-xs text-slate-400">
                                                <svg class="mr-0.5 inline-block h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                                </svg>
                                                {{ event_doc.document.document_date|date:"d/m/Y" }}
                                            </span>
                                            {% endif %}
                                        </div>
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </aside>
    </div>
</main>
{% endblock %}
